<!doctype html>
<html>
  <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-87598302-1"></script>
      <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87598302-1');
</script>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BeAPI-API-Framework</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <img src="beapi_logo2.png" style="width:auto;height:auto;">
        <p></p>

        <ul>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/index.html"><strong>Installation</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confserv.html"><strong>Configure Server</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confdb.html"><strong>Configure Database</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confapi.html"><strong>Configure API Application</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/bootstrap.html"><strong>Bootstrapping</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/model.html"><strong>Model/Domain Object</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/controller.html"><strong>Controller</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/iostate.html"><strong>IO State</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/version.html"><strong>Versioning</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/user.html"><strong>User Management</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/security.html"><strong>Security</strong></a>
                <ul>
                    <li><a href="security.html#cors">CORS / NetworkGroups</a></li>
                    <li><a href="security.html#roles">Roles / NetworkRoles</a></li>
                </ul>
            </li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/usage.html"><strong>API Usage</strong></a>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/batch.html"><strong>Batch Processing</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/chain.html"><strong>Api Chaining</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/hook.html"><strong>Web Hooks</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/ping.html"><strong>PING Architecture</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/rate.html"><strong>Rate Limiting</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/docs.html"><strong>API Docs</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/troubleshooting.html"><strong>Troubleshooting</strong></a></li>
          <li>&nbsp</li>

        </ul>
      </header>
      <section>

  <h1><a id="req" class="anchor" href="#req" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security</h1>
  <p>When adding security to your endpoints, there are two levels that we take into consideration: CORS for securing application access and ROLES for securing user access. Below we will go over how you can better configure these two in your implementation.</p>

  </br>
  <h3><a id="cors" class="anchor" href="#conf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CORS / NetworkGroups</h3>
  <p>At the top of your 'beapi_api.yml' config file, you will see a group of lines that look like this:</p>
  <pre><code>apitoolkit:
    apiName: api
    attempts: 5
    procCores: 8
    networkGroups: ['private','public']
    ...</code></pre>

  <p>Right now we are only interested in <b>networkGroups</b>. 'networkGroups' defines groups of 'allowedOrigins' for CORS (Cross Origin Resource Sharing) which we can then associate with each group of endpoints in our IO state files. We associate the 'allowedOrigins' further down in the 'beapi_api.yml' file  under corsInterceptor:</p>
          <pre><code>    corsInterceptor:
        includeEnvironments: ['development','test','production']
        excludeEnvironments: []
        networkGroups:
            public: ['http://localhost','http://localhost:8080','http://127.0.0.1','http://test.nosegrind.net']
            private: ['http://localhost','http://localhost:8080','http://127.0.0.1']  </code></pre>



  <p>Once we have the Network groups named and defined, we can then assign them in our IO State. Below is the top of our 'Person' IO State file as an example of how we do the assignment:</p>
  <pre><code>{
    "NAME":"person",
    "NETWORKGRP": "public",
    "VALUES": {
        ...</code></pre>
<p>As you can see, we use the 'public' networkGrp so it upon lookup of the endpoint, we immediately know which 'allowedOrigins' to use. Others might use 'private so that we can use INTERNAL networks rather than EXTERNAL networks. This makes it easier for us to use one backend for internal and external endpoints.</p>

</br>
<h3><a id="authjs" class="anchor" href="#conf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roles / NetworkRoles</h3>
<p>To do the same thing and get your token in Javascript for your frontend, you can do something similar to the following and store it in a token for use on following calls:</p>

<pre><code>    $.ajax({
    type: 'POST',
    url: window.url + "/api/login",
    cache:false,
    async:true,
    contentType: 'application/json',
    data: JSON.stringify(jsonData),
    //dataType:'json',
    headers: {
        'Access-Control-Allow-Origin': '*'
    },
    xhrFields:{
        withCredentials: true
    },
    crossDomain: true,
    success: function (data, textStatus, xhr){
    ...
    },
    complete: function (xhr, textStatus) {
    ...
    }
}).done(function(data, textStatus, jqXHR) {
...
}).fail(function(jqXHR, textStatus, errorThrown) {
...
})</code></pre>

</br>
<h3><a id="data_shell" class="anchor" href="#conf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling API Via Shell</h3>
<p><b><span style="text-decoration: underline;">GET Example</span></b></p>
<pre><code>curl -H "Content-Type: application/json" -H "Authorization: Bearer <your_token>"  --request GET "http://localhost:8080/v0.1/person/show/1"</code></pre>
<p><b><span style="text-decoration: underline;">PUT Example</span></b></p>
<pre><code>curl -H "Content-Type: application/json" -H "Authorization: Bearer <your_token>" --request PUT -d "{'title':'testamundo'"} "http://localhost:8080/v0.1/post/update/1"</code></pre>

</br>
<h3><a id="data_js" class="anchor" href="#conf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling API Via Javascript</h3>
<p><b><span style="text-decoration: underline;">GET Example</span></b></p>
<pre><code>$.ajax({
    type: 'GET',
    url: window.url+"/v0.1/"+path+"?"+string,
    crossDomain: true,
    cache:false,
    xhrFields: {
        withCredentials: false
    },
    beforeSend: function(request){
        request.setRequestHeader('Authorization','Bearer '+window.token.access_token);
    },
    headers:{
        'Content-Type': contenttype
    },
    dataType: datatype,
    success: function(data) {
        if(data){
        ...
        }
    },
    error: function(jqXHR, textStatus, errorThrown) {
            document.getElementById("output_"+count).innerHTML = jqXHR.status+" : "+jqXHR.statusText;
    },
});</code></pre>
<p><b><span style="text-decoration: underline;">PUT Example</span></b></p>
<pre><code>$.ajax({
    type: 'PUT',
    url: window.url+"/v0.1/"+path,
    data: JSON.stringify(jsonData),
    crossDomain: true,
    cache:false,
    xhrFields: {
        withCredentials: false
    },
    beforeSend: function(request){
        request.setRequestHeader('Authorization','Bearer '+window.token.access_token);
    },
    headers:{
        'Content-Type': contenttype
    },
    dataType: datatype,
    success: function(data) {
        if(data){
        ...
        }
    },
    error: function(jqXHR, textStatus, errorThrown) {
            document.getElementById("output_"+count).innerHTML = jqXHR.status+" : "+jqXHR.statusText;
    },
});</code></pre>

      </section>
      <footer>
        <p class="view"><a href="https://github.com/orubel/Beapi-API-Framework">View the Project on GitHub <small>orubel/Beapi-API-Framework</small></a></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
