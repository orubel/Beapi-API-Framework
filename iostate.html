<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BeAPI-API-Framework</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <img src="beapi_logo2.png" style="width:auto;height:auto;">
        <p></p>

        <ul>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/index.html"><strong>Installation</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confserv.html"><strong>Configure Server</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confdb.html"><strong>Configure Database</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confapi.html"><strong>Configure API Application</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/bootstrap.html"><strong>Bootstrapping</strong></a></li>
	        <li><a href="http://orubel.github.io/Beapi-API-Framework/model.html"><strong>Model/Domain Object</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/controller.html"><strong>Controller</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/iostate.html"><strong>IO State</strong></a></li>
            <ul>
              <li><a href="iostate.html#vars">Variables Declaration</a></li>
              <li><a href="iostate.html#rules">Rules Declaration</a></li>
                <li><a href="iostate.html#empty">Empty PermitAll</a></li>
            </ul>
          </li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/version.html"><strong>Versioning</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/user.html"><strong>User Management</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/usage.html"><strong>API Usage</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/batch.html"><strong>Batch Processing</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/chain.html"><strong>Api Chaining</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/hook.html"><strong>Web Hooks</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/ping.html"><strong>PING Architecture</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/rate.html"><strong>Rate Limiting</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/docs.html"><strong>API Docs</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/troubleshooting.html"><strong>Troubleshooting</strong></a></li>
          <li>&nbsp</li>

        </ul>
      </header>
      <section>

        <h1><a id="what_is" class="anchor" href="#what_is" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>IO State</h1>


          <p>The IO State File is a descriptor for your API endpoints. It is a cacheable configuration file holding data directly associated with a specific group of API requests & responses. This enables all URI's (and their associated data) to be easily cached and this data to be shared with services in the architecture (ie Proxy, MQ, etc).
          <p>URI's call a common set of data as they are based on classes/method. As such, these URIs can be GROUPED and said to share a common dataset and set of config options. The IO State File is a set of rules for all URI's sharing a common data object.</p>
          <p>Examples of IO state files can be found in the example project here.</p>
          <p>To bootstrap your IOState from your domains, simply go into the the root directory of your project and type the following command from the shell:</p>
          <pre><code>./gradlew GenerateIostate</code></pre>
          <p>This will generate IO state files based on all your domains/models. A typical IO State File looks like the following:</p>
<pre><code>
{
    "NAME":"hook",
    "VALUES": {
        "id": {
            "type": "PKEY",
            "description":"ID for Hook",
	    "mockData":"1"
        },
        "version": {
            "type": "Long",
            "description":"Version for Updating Hook",
	    "mockData":"0"
        },
        "user": {
            "type": "FKEY",
            "description":"User relationship",
	    "mockData":"1"
        },
        "name": {
            "type": "String",
            "description":"Name of Hook",
	    "mockData":"mockHook"
        },
        "url": {
            "type": "String",
            "description":"Subscribers Receiving URL for Hook",
	    "mockData":"127.0.0.1:80/test"
        },
        "format": {
            "type": "String",
            "description":"JSON/XML",
	    "mockData":"JSON"
        },
        "service": {
            "type": "String",
            "description":"Api Service being Subscribed to",
	    "mockData":"mockEndpoint"
        },
        "authentication": {
            "type": "String",
            "description":"Token type",
	    "mockData":"Bearer 23978ywe0fdi8h309u4ju0309je3r90f"
        }
    },
	"CURRENTSTABLE": "1",
	"VERSION": {
		"1": {
			"DOMAINPACKAGE":"",
			"DEFAULTACTION":"list",
			"URI": {
				"list": {
				     	"METHOD":"GET",
				    	"DESCRIPTION":"List Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":[]
					},
					"RESPONSE": {
						"permitAll":["id","version","user","name","url","format","service","authentication"]
					}
				},
				"show": {
					"METHOD":"GET",
					"DESCRIPTION":"Show Hooks",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
						"permitAll":["id","version","user","name","url","format","service","authentication"]
					}
				},
				"create":{
					"METHOD":"PUT",
					"DESCRIPTION":"Create Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["name","url","format","service","authentication"]
					},
					"RESPONSE": {
						"permitAll":["id","version"]
					}
				},
				"update": {
					"METHOD":"POST",
					"DESCRIPTION":"Update Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id","version","name","url","format","service","authentication"]
					},
					"RESPONSE": {
					    "permitAll":["id","version"]
					}
				},
				"delete":{
					"METHOD":"DELETE",
					"DESCRIPTION":"Delete Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
					    "permitAll":["id"]
					}
				},
				"reset":{
					"METHOD":"GET",
					"DESCRIPTION":"Reset Hook attempts",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
					    "permitAll":["id"]
					}
				}
			}
		}
	}
}
</code></pre>

        <h3><a id="vars" class="anchor" href="#values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Variable Declaration</h3>

          <p>Lets break apart the pieces of an IOState file to see what they consist of and how they work; the first part of the file declares 'VALUES' for use by the endpoints:</p>
<pre><code>    "NAME":"person",
    "VALUES": {
        "id": {
            "key": "PRIMARY",
            "type": "Long",
            "description":"ID for Event",
        "mockData":"1"
        },
        "version": {
            "type": "Long",
            "description":"Version for Event",
        "mockData":"0"
        },

        ...</code></pre>

        <p>We  start by declaring the NAME of the file and our 'values':
        <ul>
        <li><b><span style="text-decoration: underline;">NAME :</span></b> This corresponds directly with the name of the controller; the controller typically pulls in from the same domain name but does not have to. The controller can create a nested call, return a file, etc. So the name directly relates to the controller.</li>
        <li><b><span style="text-decoration: underline;">VALUES :</span></b> These are the individual variables returned. These help us for automating testing, api docs and defining what needs to be sent and returned in each endpoint.</li>
        </ul>
        </p>

        <p>Underneath values, then define each individual value to be sent/returned with the following stats:
        <ul>
          <li><b><span style="text-decoration: underline;">type</span> : PKEY, FKEY, INDEX, STRING, DATE, LONG, BOOLEAN, FLOAT, BIGDECIMAL, EMAIL, URL, ARRAY, COMPOSITE</b> - <b>(required)</b> Defines scope of variable; only used for apidocs/options or for reference.</li>
          <li><b><span style="text-decoration: underline;">description</span> : variable description</b> - <b>(required)</b> description of variable, how it is used. mainly for apidocs</li>
          <li><b><span style="text-decoration: underline;">references</span> : see below  - (optional)</b> This allows someone to point a PKEY/FKEY/Index to its referencing IO State Object NAME. Usage is as follows:</li>
          <ul>
            <li><span style="text-decoration: underline;">references: self (type:Long)</span> - primary key, reference to self;</li>
            <li><span style="text-decoration: underline;">references: name of API Object referenced w/ (type:Long)</span> - foreign key; referenced to IO State Object</li>
            <li><span style="text-decoration: underline;">references : self or name of API Object referenced w/ (type:String)</span> - index;reference to IO State Object</li>
          </ul>
          <li><b><span style="text-decoration: underline;">mockData</span> : 'string descriptor' - (optional)</b> Mock data for options and apidoc.</li>
        </ul>
        </p>


</br>
<h3><a id="rules" class="anchor" href="#values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rules Declaration</h3>
<p>Following this, we then define the 'rules' for our endpoints in the IOState like so:</p>
<pre><code>    "CURRENTSTABLE": "1",
    "VERSION": {
        "1": {
            "DEFAULTACTION":"list",
            "URI": {
                "create": {
                    "METHOD":"POST",
                    "DESCRIPTION":"Create new Person",
                    "ROLES":{
                        "DEFAULT":["ROLE_ADMIN","ROLE_USER"],
                        "BATCH":["ROLE_ADMIN"],
                        "HOOK":["ROLE_ADMIN"]
                    },
                    "REQUEST": {
                        "permitAll":["username","password","email"]
                    },
                    "RESPONSE": {
                        "permitAll":["id","version"]
                    }
                },
                ...</code></pre>

<p>The above data has the following definitions:
<ul>
          <li><b><span style="text-decoration: underline;">CURRENTSTABLE :</span></b> This is the current stable version of IOState; if you you do not have multiple versions of this file, this number is the same as 'VERSION'</li>
          <li><b><span style="text-decoration: underline;">VERSION :</span></b> This is the file version. This allows to API to have several versions of IOState if you are currently supported deprecated versions
          <ul>
              <li><b><span style="text-decoration: underline;">DEFAULTACTION :</span></b>​ This is the default endpoint action if if none given; commonly 'list'</li>
              <li><b><span style="text-decoration: underline;">URI :</span></b>​​ This is the endpoint and the rules for the endpoint.</li>
          </ul>
          </li>
</ul>
</p>

<p>Then under 'URI', you define the endpoint for the controller. In this case for the NAME 'person' and URI 'create', the full endpoint would be:</p>
<pre><code>http://<yourdomain>/v0.1/person/create</code></pre>
<p>We will explain more about where the 'v0.1' comes under <a href="http://orubel.github.io/Beapi-API-Framework/version.html">'Versioning'</a> but for right now, lets finish explaining the rest of the IOState:</p>
<ul>
    <li><b><span style="text-decoration: underline;">METHOD :</span></b> One of [GET, PUT, POST,DELETE]. This defines how the endpoint should be called.</li>
    <li><b><span style="text-decoration: underline;">DESCRIPTION :</span></b> A description of the endpoint for the API Docs</li>
    <li><b><span style="text-decoration: underline;">ROLES :</span></b> a grouping for security rules</li>
    <li><b><span style="text-decoration: underline;">DEFAULT​ :</span></b> Default security roles for endpoints</li>
    <li><b><span style="text-decoration: underline;">BATCH :</span></b> Security roles for endpoints that have batching enabled</li>
    <li><b><span style="text-decoration: underline;">HOOK :</span></b> Security roles for endpoints that have web hooks enabled</li>
    <li><b><span style="text-decoration: underline;">REQUEST :</span></b>​ per role data for expected when sending the request; concatenates across roles</li>
    <li><b><span style="text-decoration: underline;">RESPONSE :</span></b> per role data for expected when sending the request; concatenates across roles</li>
</ul>
<p><b>Of note on REQUEST/RESPONSE and ROLES</b>: one can set different access levels by concatenating privileges. Their is a default privilege level called 'permitAll' which will allow ALL privileges set in ROLES>DEFAULT access to this data. You can then allow more atomic access by setting additional values PER ROLE like so:
<pre><code>"REQUEST": {
    "permitAll":["name"],
    "ROLE_USER":["id"]
},</code></pre>



</br>
<h3><a id="empty" class="anchor" href="#values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Empty PermitAll</h3>
<p>If you are sending no values (such as a 'list' call) or returning no values, you weill often have an empty 'permitAll' such as the following:</p>
<pre><code>			        "REQUEST": {
			            "permitAll":[]
			        },</code></pre>
<p>An empty 'permitAll' should NEVER be declared with quotes as this sends an empty string. Always leave the brackets empty like above to declare that nothing needs to be sent.</p>

</p>
</section>
      <footer>
        <p class="view"><a href="https://github.com/orubel/Beapi-API-Framework">View the Project on GitHub <small>orubel/Beapi-API-Framework</small></a></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
