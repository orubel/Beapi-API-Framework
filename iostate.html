<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BeAPI-API-Framework</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <img src="beapi_logo2.png" style="width:auto;height:auto;">
        <p></p>

        <ul>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/installation.html"><strong>Installation</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confserv.html"><strong>Configure Server</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confdb.html"><strong>Configure Database</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/confapi.html"><strong>Configure API Application</strong></a></li>
	        <li><a href="http://orubel.github.io/Beapi-API-Framework/model.html"><strong>Model/Domain Object</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/controller.html"><strong>Controller</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/iostate.html"><strong>IO State</strong></a></li>
            <ul>
              <li><a href="iostate.html#what_is">What is IO State</a></li>
              <li><a href="iostate.html#values">Defining Values</a></li>
              <li><a href="iostate.html#rules">Defining URI Rules</a></li>
	          <li><a href="iostate.html#FAQ">FAQ</a></li>
            </ul>
          </li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/usage.html"><strong>API Usage</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/batch.html"><strong>Batch Processing</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/chain.html"><strong>Api Chaining</strong></a></li>
            <li><a href="http://orubel.github.io/Beapi-API-Framework/hook.html"><strong>Web Hooks</strong></a></li>
          <li><a href="http://orubel.github.io/Beapi-API-Framework/troubleshooting.html"><strong>Troubleshooting</strong></a></li>
          <li>&nbsp</li>

        </ul>
      </header>
      <section>
        <h3><a id="what_is" class="anchor" href="#what_is" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What Is IO State?</h3>

          <p><b>[Patent Pending 2014 Owen Rubel]</b></p>

          <p>The IO State File is a descriptor for your API for your entire architecture. It is a cacheable configuration file holding data directly associated with a specific API request/response grouping. This enables all URI's (and their associated data) to be easily cached and this data to be shared with services sharing in the IO Flow (ie Proxy, MQ, etc).</p>
          <p>URI's call a common set of data as they are based on classes/method. As such, these URIs can be GROUPED and said to share a common dataset and set of config options. The IO State File is a set of rules for all URI's sharing a common data object.</p>
          <p>A typical IO State File looks like this:</p>
<pre><code>
{
    "NAME":"hook",
    "VALUES": {
        "id": {
            "type": "PKEY",
            "description":"ID for Hook",
	    "mockData":"1"
        },
        "version": {
            "type": "Long",
            "description":"Version for Updating Hook",
	    "mockData":"0"
        },
        "user": {
            "type": "FKEY",
            "description":"User relationship",
	    "mockData":"1"
        },
        "name": {
            "type": "String",
            "description":"Name of Hook",
	    "mockData":"mockHook"
        },
        "url": {
            "type": "String",
            "description":"Subscribers Receiving URL for Hook",
	    "mockData":"127.0.0.1:80/test"
        },
        "format": {
            "type": "String",
            "description":"JSON/XML",
	    "mockData":"JSON"
        },
        "service": {
            "type": "String",
            "description":"Api Service being Subscribed to",
	    "mockData":"mockEndpoint"
        },
        "authentication": {
            "type": "String",
            "description":"Token type",
	    "mockData":"Bearer 23978ywe0fdi8h309u4ju0309je3r90f"
        }
    },
	"CURRENTSTABLE": "1",
	"VERSION": {
		"1": {
			"DOMAINPACKAGE":"",
			"DEFAULTACTION":"list",
			"URI": {
				"list": {
				     	"METHOD":"GET",
				    	"DESCRIPTION":"List Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":[]
					},
					"RESPONSE": {
						"permitAll":["id","version","user","name","url","format","service","authentication"]
					}
				},
				"show": {
					"METHOD":"GET",
					"DESCRIPTION":"Show Hooks",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
						"permitAll":["id","version","user","name","url","format","service","authentication"]
					}
				},
				"create":{
					"METHOD":"PUT",
					"DESCRIPTION":"Create Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["name","url","format","service","authentication"]
					},
					"RESPONSE": {
						"permitAll":["id","version"]
					}
				},
				"update": {
					"METHOD":"POST",
					"DESCRIPTION":"Update Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id","version","name","url","format","service","authentication"]
					},
					"RESPONSE": {
					    "permitAll":["id","version"]
					}
				},
				"delete":{
					"METHOD":"DELETE",
					"DESCRIPTION":"Delete Hook",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN","ROLE_ARCH"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
					    "permitAll":["id"]
					}
				},
				"reset":{
					"METHOD":"GET",
					"DESCRIPTION":"Reset Hook attempts",
				    	"ROLES": {
					    "DEFAULT":["permitAll"],
				    	    "BATCH":["ROLE_ADMIN"]
					},
					"REQUEST": {
					    "permitAll":["id"]
					},
					"RESPONSE": {
					    "permitAll":["id"]
					}
				}
			}
		}
	}
}
</code></pre>

        <h3><a id="values" class="anchor" href="#values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Defining VALUES</h3>

        <p>The IO State File is all about defining IO state:</p>
<pre><code>the I/O definitions and rules for a common set of values that are used by URI's associated with GET/POST/PUT/DELETE methods. In the API Object, The 'values' can have two different 'key/value' pair types : definitions and rules.
</code></pre>

        <p><b>'VALUES'</b> basically defines the variable names and their corresponding data types. These are then in turn used by the 'Rules' ( VERSION>URI ) that set limitations on the request/response. Below are the definitions and rules used in above API Object:</p>

        <ul>
          <li><b><span style="text-decoration: underline;">type</span> : PKEY, FKEY, INDEX, STRING, DATE, LONG, BOOLEAN, FLOAT, BIGDECIMAL, EMAIL, URL, ARRAY, COMPOSITE</b> - <b>(required)</b> Defines scope of variable; only used for apidocs/options or for reference.</li>
          <li><b><span style="text-decoration: underline;">description</span> : variable description</b> - <b>(required)</b> description of variable, how it is used. mainly for apidocs</li>
          <li><b><span style="text-decoration: underline;">references</span> : see below  - (optional)</b> This allows someone to point a PKEY/FKEY/Index to its referencing IO State Object NAME. Usage is as follows:</li>
          <ul>
            <li><span style="text-decoration: underline;">references: self (type:Long)</span> - primary key, reference to self;</li>
            <li><span style="text-decoration: underline;">references: name of API Object referenced w/ (type:Long)</span> - foreign key; referenced to IO State Object</li>
            <li><span style="text-decoration: underline;">references : self or name of API Object referenced w/ (type:String)</span> - index;reference to IO State Object</li>
          </ul>
          <li><b><span style="text-decoration: underline;">mockData</span> : 'string descriptor' - (optional)</b> Mock data for options and apidoc.</li>
        </ul>


<h3>
<a id="rules" class="anchor" href="#rules" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Defining URI Rules</h3>

<p>Underneath <b>URI</b>, you list out all the <b>'endpoints'</b> for this Controller. If you put endpoints for a separate controller in here, they will not map.</p>
<p>Once you have mapped all your endpoints, you will need to assign then the following rules:</p>
<ul>
<li><b>METHOD:</b> GET/PUT/POST/DELETE</li>
<li><b>DESCRIPTION:</b> <String> ; A String Describing API; This is used for API Doc generation".</li>
<li><b>ROLES:</b> A List of Roles that have access to this endpoint this endpoint. Uses Spring-Security.</li>
<li><b>BATCH:</b> A list of Roles that have access to send batch jobs on this endpoint. Uses Spring-Security.</li>
<li><b>REQUEST:</b> A map of roles with <b>VALUES</b> expected to be sent at request.</li>
<li><b>RESPONSE:</b> A map of roles with <b>VALUES</b> expected to be returned at response.</li>
</ul>

<h3>
<a id="FAQ" class="anchor" href="#FAQ" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FAQ</h3>

        <p>
        <b>Why can't we just move services like Security to the proxy or Gateway?</b></br>
        Doing AUTH check (or other checks) at the proxy/gateway does not solve for forwards/redirects where the roles need to be checked again. This shows the issue with the architectural cross cutting concern. This data needs to be duplicated to avoid the dropped thread and roundtrip. But then, we can't synchronize it. In our system, we synchronize then duplicate and make sure that all duplicate are coming from one centralized source.
        </p>

        <p>
        <b>Is 'type' checking done on incoming response or outgoing request?</b></br>
        Type Validation is an operation performed by the MODEL/Domain. Since no assignment is done at the API Layer, this isn't suggested as this slows down your api. What 'type' does is set a declaration on the variable so we can use it for OPTIONS and apidocs. It also is used for api chaining so objects can reference each other at the front controller by assigning a 'key'. Potentially we MAY autobuild this in the future based on Domain Objects
        </p>

        <p>
        <b>It stated that the IO State does data checking? Isn't data checking the same thing as validation?</b></br>
        If one checks to see if a set of variables are being sent for the privilege the api expects, that is data checking. If one VALIDATEs that data for what it is stated to be set as, that is validation. This is the difference between what the API Layer does and what the MODEL layer does
        </p>

        <p>
        <b>Does the IO State Object need to be called with every call?</b></br>
        No. The IO State Object is loaded at runtime, processed and then the final object (not JS) is loaded into a cache (ideally). This gives us a language specific object that we can use for each individual method api call with the definitions,rules and roles.
        </p>

        <p>
        <b>Can this work with external api's?</b></br>
        Yes. To do this you would normally create a separate controller/action that calls the external api. This would give you an internal URI reference point. The api object checks the data before going to the external service and will check the data coming back.
        </p>

        <p>
        <b>Why is the object in JSON when you are coding in Groovy/Java?</b></br>
        JSON allows us to abstract the object so we can reload on the fly and recache if we need to. JSON also allows for definition of a base object in a form that can be used by any architectural point as well regardless of what language it is written in.
        </p>

</section>
      <footer>
        <p class="view"><a href="https://github.com/orubel/Beapi-API-Framework">View the Project on GitHub <small>orubel/Beapi-API-Framework</small></a></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
